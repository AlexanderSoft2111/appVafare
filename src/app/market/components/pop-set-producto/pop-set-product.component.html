<form [formGroup]="articuloForm" (ngSubmit)=guardar()>
  <ion-card class="m-0 none">
    <ion-item detail="false" class="none item-native">
      <ion-label class="text-center">
        <strong>{{titulo}}</strong>
      </ion-label>
      <ion-buttons slot="end">
        @if (venta) {
        <ion-button (click)="aceptar()">
          <ion-icon slot="icon-only" name="checkbox" color="success"></ion-icon>
        </ion-button>
        }
        <ion-button (click)="close()">
          <ion-icon slot="icon-only" name="close" color="dark"></ion-icon>
        </ion-button>
      </ion-buttons>
    </ion-item>



      <ion-grid fixed> <!-- opcional: usa breakpoints fijos de Ionic -->
  <!-- Código + Nombre en una fila (2 cols en md+, 1 col en móvil) -->
  <ion-row>
    <ion-col size="12" sizeMd="6">
      <mat-form-field>
        <mat-label>Código:</mat-label>
        <input #codigo matInput maxlength="13"
               formControlName="codigo"
               (blur)="validarCodigoUnico()"
               (keydown.enter)="validarCodigoUnico()">
        @if (campoNoValido('codigo')) { <mat-error>El código <strong>es requerida</strong></mat-error> }
        @if (codigoDuplicado())     { <mat-error>Ya existe <strong>un producto con este código</strong></mat-error> }
      </mat-form-field>
    </ion-col>

    <ion-col size="12" sizeMd="6">
      <mat-form-field>
        <mat-label>Nombre:</mat-label>
        <input matInput formControlName="nombre" autocomplete="off">
        @if (campoNoValido('nombre')) { <mat-error>El nombre <strong>es requerido</strong></mat-error> }
      </mat-form-field>
    </ion-col>
  </ion-row>

  <!-- Descripción: ancho completo -->
  <ion-row>
    <ion-col size="12">
      <mat-form-field>
        <mat-label>Descripción:</mat-label>
        <input matInput formControlName="descripcion" autocomplete="off">
        @if (campoNoValido('descripcion')) { <mat-error>La descripción <strong>es requerida</strong></mat-error> }
      </mat-form-field>
    </ion-col>
  </ion-row>

  <!-- Costo compra | Costo sin IVA | PVP -->
  <ion-row>
    <ion-col size="12" sizeMd="6" sizeLg="4" sizeXl="4">
      <mat-form-field class="iva-field">
        <mat-label>Costo de compra</mat-label>
        <input matInput type="number" inputmode="decimal" min="0" step="0.01"
               placeholder="0.00" formControlName="costo_compra" />
        <mat-checkbox matSuffix class="iva-suffix" formControlName="check_iva">Tiene IVA?</mat-checkbox>
        @if (campoNoValido('costo_compra')) { <mat-error>El costo de compra <strong>es requerido</strong></mat-error> }
      </mat-form-field>
    </ion-col>

    <ion-col size="12" sizeMd="6" sizeLg="4" sizeXl="4">
      <mat-form-field>
        <mat-label>Costo sin IVA:</mat-label>
        <input matInput type="number" step="0.01" formControlName="costo_sin_iva">
      </mat-form-field>
    </ion-col>

    <ion-col size="12" sizeMd="6" sizeLg="4" sizeXl="4">
      <mat-form-field>
        <mat-label>PVP:</mat-label>
        <input matInput type="number" step="0.01" formControlName="pvp">
        @if (campoNoValido('pvp')) { <mat-error>El PVP <strong>es requerido</strong></mat-error> }
      </mat-form-field>
    </ion-col>
  </ion-row>

  <!-- Stock | Fecha | Stock mínimo -->
  <ion-row>
    <ion-col size="12" sizeMd="6" sizeLg="4" sizeXl="4">
      <mat-form-field>
        <mat-label>Stock:</mat-label>
        <input matInput type="number" formControlName="stock">
        @if (campoNoValido('stock')) { <mat-error>El stock <strong>es requerido</strong></mat-error> }
      </mat-form-field>
    </ion-col>

    <ion-col size="12" sizeMd="6" sizeLg="4" sizeXl="4">
      <mat-form-field>
        <mat-label>Fecha de caducidad:</mat-label>
        <input matInput type="date" formControlName="fecha_caducidad">
        @if (campoNoValido('fecha_caducidad')) { <mat-error>La fecha de caducidad <strong>es requerida</strong></mat-error> }
      </mat-form-field>
    </ion-col>

    <ion-col size="12" sizeMd="6" sizeLg="4" sizeXl="4">
      <mat-form-field>
        <mat-label>Stock mínimo:</mat-label>
        <input matInput type="number" formControlName="stock_minimo">
        @if (campoNoValido('stock_minimo')) { <mat-error>El stock mínimo <strong>es requerido</strong></mat-error> }
      </mat-form-field>
    </ion-col>
  </ion-row>

  <!-- Acciones -->
  <ion-row class="ion-justify-content-end">
    <ion-col size="12" sizeMd="auto">
      <div class="actions-right">
        <ion-button color="dark" (click)="close()">Cancelar</ion-button>
        @if (!update) {
          <ion-button [disabled]="codigoDuplicado() || isSaving" fill="clear" (click)="guardar()" class="boton-primario">OK</ion-button>
        } @else {
          <ion-button [disabled]="codigoDuplicado() || isSaving" fill="clear" (click)="updateProduct()" class="boton-primario">Actualizar</ion-button>
        }
      </div>
    </ion-col>
  </ion-row>
</ion-grid>


  </ion-card>
</form>
