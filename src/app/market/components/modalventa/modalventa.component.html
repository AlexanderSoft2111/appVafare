<ion-header>
  <ion-toolbar color="light">
    <ion-title>
      <strong>Venta #{{ venta.numero }}</strong>
    </ion-title>
    <ion-buttons slot="end">
      <ion-button (click)="closeModal()">
        <ion-icon name="close"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content class="ion-padding">
  @if (venta) {
    <!-- Encabezado con cliente + venta -->
    <div class="seccion venta-info mat-elevation-z2">
      <div class="col">
        <h2>Cliente</h2>
        <p><strong>Nombre:</strong> {{ venta.cliente.nombre }}</p>
        <p><strong>RUC/CI:</strong> {{ venta.cliente.ruc }}</p>
        <p><strong>Teléfono:</strong> {{ venta.cliente.telefono }}</p>
        <p><strong>Dirección:</strong> {{ venta.cliente.direccion }}</p>
        <p><strong>Correo:</strong> {{ venta.cliente.email }}</p>
      </div>
      <div class="col">
        <h2>Venta</h2>
        <p><strong>Fecha:</strong> {{ venta.fecha | date:'fullDate' }}</p>
        <p><strong>Hora:</strong> {{ venta.fecha | date:'shortTime' }}</p>
        <p><strong>Número:</strong> {{ venta.numero }}</p>
        <div class="precio-final">${{ venta.total.toFixed(2) }}</div>
      </div>
    </div>

    <mat-divider></mat-divider>

    <!-- Productos -->
    <div class="seccion productos mat-elevation-z2">
      <h2>Productos</h2>
      <table mat-table [dataSource]="venta.productos" class="mat-elevation-z1 tabla">

        <!-- Codigo -->
        <ng-container matColumnDef="codigo">
          <th mat-header-cell *matHeaderCellDef> Producto </th>
          <td mat-cell *matCellDef="let p"> {{ p.producto?.codigo }} </td>
        </ng-container>

        <!-- Nombre -->
        <ng-container matColumnDef="nombre">
          <th mat-header-cell *matHeaderCellDef> Producto </th>
          <td mat-cell *matCellDef="let p"> {{ p.producto?.nombre }} </td>
        </ng-container>

        <!-- Cantidad -->
        <ng-container matColumnDef="cantidad">
          <th mat-header-cell *matHeaderCellDef> Cantidad </th>
          <td mat-cell *matCellDef="let p"> {{ p.cantidad }} </td>
        </ng-container>

        <!-- Importe -->
        <ng-container matColumnDef="precio">
          <th mat-header-cell *matHeaderCellDef> Precio </th>
          <td mat-cell *matCellDef="let p"> ${{ p.producto.pvp.toFixed(2) }} </td>
        </ng-container>

        <!-- IVA -->
        <ng-container matColumnDef="IVA">
          <th mat-header-cell *matHeaderCellDef> IVA </th>
          <td mat-cell *matCellDef="let p"> ${{ (p.producto.pvp * 0.15).toFixed(2) }} </td>

        </ng-container>
        <!-- Subtotal -->
        <ng-container matColumnDef="subtotal">
          <th mat-header-cell *matHeaderCellDef> Subtotal </th>
          <td mat-cell *matCellDef="let p"> ${{ (p.precio).toFixed(2) }} </td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>


      </table>

      <!-- Totales -->
      <div class="totales">
        <p><strong>Subtotal:</strong> ${{venta.subtotal_sin_iva.toFixed(2) }}</p>
        <p><strong>IVA:</strong> ${{ venta.iva.toFixed(2) }}</p>
        <p class="total"><strong>Total:</strong> ${{ venta.total.toFixed(2) }}</p>
      </div>
    </div>
  }
</ion-content>
